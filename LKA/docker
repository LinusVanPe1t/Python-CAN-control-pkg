mkdir -p ~/ufld_docker/workspace
cd ~/ufld_docker

cat <<EOF > Dockerfile
FROM osrf/ros:humble-desktop

# 기본 툴 설치
RUN apt-get update && apt-get install -y \\
    python3-pip \\
    python3-colcon-common-extensions \\
    git \\
    libgl1-mesa-glx \\
    libglib2.0-0 \\
    && rm -rf /var/lib/apt/lists/*

# PyTorch 및 의존성 설치 (CUDA 11.8 호환)
RUN pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
# numpy 버전을 2.0 미만으로 강제 지정
RUN pip3 install scipy "numpy<2.0" opencv-python matplotlib

# 환경 변수 설정
RUN echo "source /opt/ros/humble/setup.bash" >> ~/.bashrc

WORKDIR /root/ros2_ws
EOF

------------------------------------------------------------------------------------

cat <<EOF > docker-compose.yaml
version: '3.8'

services:
  ufld_dev:
    build: .
    image: ufld_ros:humble
    container_name: ufld_container
    network_mode: "host" 
    ipc: host
    pid: host
    
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]

    environment:
      - DISPLAY=\${DISPLAY}
      - QT_X11_NO_MITSHM=1
      - NVIDIA_DRIVER_CAPABILITIES=all
    
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      - ./workspace:/root/ros2_ws/src
    
    command: tail -f /dev/null
    stdin_open: true
    tty: true
EOF

xhost +local:root

docker compose up -d --build

이후 에러


# 1. 필수 패키지 설치
sudo apt-get update
sudo apt-get install -y ca-certificates curl gnupg

# 2. Docker 공식 GPG 키 추가
sudo install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo chmod a+r /etc/apt/keyrings/docker.gpg

# 3. 리포지토리 추가
echo \
  "deb [arch="$(dpkg --print-architecture)" signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  "$(. /etc/os-release && echo "$VERSION_CODENAME")" stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# 4. Docker 엔진 설치
sudo apt-get update
sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

sudo usermod -aG docker $USER

# 1. NVIDIA 패키지 저장소 추가
curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg \
  && curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list | \
    sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' | \
    sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list

# 2. 툴킷 설치
sudo apt-get update
sudo apt-get install -y nvidia-container-toolkit

# 3. Docker 설정 후 재시작
sudo nvidia-ctk runtime configure --runtime=docker
sudo systemctl restart docker

newgrp docker

docker compose up -d --build

docker exec -it ufld_container bash

nvidia-smi

ros2 --help


